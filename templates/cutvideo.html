{% extends "base.html" %}
{% block title %}Cắt Video Nhanh - Nghị Edition{% endblock %}
{% block content %}
<h1 class="text-2xl font-bold text-blue-700 mb-4">✂️ Cắt Video Nhanh</h1>
<form method="post" enctype="multipart/form-data" class="space-y-4" id="cut-form">
    <label class="block font-medium mb-1">Chọn hoặc kéo thả nhiều video (MP4):</label>
    <input type="file" name="videos" accept=".mp4,.avi,.mov,.mkv" multiple required class="block mb-2 border p-2 rounded w-full" onchange="showFileList(this)">
    <div id="video-list"></div>

    <label class="block font-medium mt-3 mb-1">Chọn kiểu cắt:</label>
    <div class="flex space-x-5 items-center">
        <label class="flex items-center space-x-2">
            <input type="radio" name="cut_mode" value="start" checked onchange="showCutInputs()">
            <span>Cắt từ đầu</span>
        </label>
        <label class="flex items-center space-x-2">
            <input type="radio" name="cut_mode" value="middle" onchange="showCutInputs()">
            <span>Cắt ở giữa</span>
        </label>
        <label class="flex items-center space-x-2">
            <input type="radio" name="cut_mode" value="end" onchange="showCutInputs()">
            <span>Cắt từ cuối</span>
        </label>
    </div>
    <!-- Input vùng cắt -->
    <div class="flex space-x-3 items-center mt-2" id="input-start">
        <label>Số giây cần lấy từ đầu:</label>
        <input type="number" name="duration" min="1" max="36000" class="border rounded px-2 py-1 w-28" value="10" required>
        <span>giây</span>
    </div>
    <div class="flex space-x-3 items-center mt-2 hidden" id="input-middle">
        <label>Từ giây:</label>
        <input type="number" name="from_sec" min="0" max="36000" class="border rounded px-2 py-1 w-20" value="0">
        <label>đến giây:</label>
        <input type="number" name="to_sec" min="1" max="36000" class="border rounded px-2 py-1 w-20" value="10">
    </div>
    <div class="flex space-x-3 items-center mt-2 hidden" id="input-end">
        <label>Lấy số giây cuối:</label>
        <input type="number" name="tail_sec" min="1" max="36000" class="border rounded px-2 py-1 w-28" value="10">
        <span>giây</span>
    </div>
    <button type="submit" class="w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-semibold transition">
        ✂️ Cắt video
    </button>
</form>

{% if progress_msg %}
<div class="mt-6 p-3 bg-yellow-100 text-yellow-900 rounded shadow">{{ progress_msg }}</div>
{% endif %}
{% if result_files %}
<div class="mt-6">
    <h3 class="font-semibold text-blue-700 mb-2">Kết quả cắt video:</h3>
    <ul class="list-disc list-inside space-y-1">
        {% for f in result_files %}
        <li>
            <a href="{{ url_for('download_result', filename=f.display) }}" class="text-blue-700 hover:underline">{{ f.display }}</a>
        </li>
        {% endfor %}
    </ul>
    {% if zip_url %}
    <div class="mt-3">
        <a href="{{ zip_url }}" class="inline-block px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 font-semibold">⬇️ Tải tất cả (ZIP)</a>
    </div>
    {% endif %}
    {% if skipped_files %}
    <div class="mt-4 text-orange-700">
        <b>Các file dưới độ dài vùng cắt (không cắt):</b>
        <ul class="list-disc list-inside">
            {% for sf in skipped_files %}
            <li>{{ sf }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>
{% endif %}

<!-- Hướng dẫn cơ bản (footer) -->
<div class="mt-10 bg-blue-50 p-4 rounded-xl shadow text-blue-900">
    <div class="font-bold mb-2 text-blue-800 text-lg">Hướng dẫn dùng cơ bản:</div>
    <ul class="list-disc list-inside space-y-1 text-base">
        <li>1. Chọn hoặc kéo thả nhiều video vào ô phía trên.</li>
        <li>2. Chọn kiểu cắt: <b>Cắt từ đầu</b> (ví dụ nhập 10s sẽ lấy 10 giây đầu), hoặc <b>cắt ở giữa</b> (nhập từ giây... đến giây...), hoặc <b>cắt cuối</b> (lấy N giây cuối).</li>
        <li>3. Bấm <b>"Cắt video"</b>. Hệ thống sẽ xử lý, hiển thị tiến trình thực tế.</li>
        <li>4. Khi cắt xong, tải từng file hoặc bấm <b>"Tải tất cả (ZIP)"</b> để tải về 1 lần.</li>
        <li>5. Nếu video ngắn hơn vùng cắt, hệ thống sẽ giữ nguyên và báo cho bạn.</li>
        <li>Lưu ý: File xuất ra sẽ có tên gốc + thông tin vùng cắt, ví dụ <span class="font-mono">Video001_10s.mp4</span> hoặc <span class="font-mono">Video002_5-15s.mp4</span>.</li>
    </ul>
</div>

<script>
function showFileList(input) {
    let files = input.files;
    let html = '';
    if(files.length) {
        html = '<div class="mt-3"><h3 class="font-semibold text-gray-700 mb-2">Danh sách video đã chọn:</h3><ol class="list-decimal list-inside">';
        for(let i=0; i<files.length; i++) {
            html += `<li><span class='font-mono'>${files[i].name}</span></li>`;
        }
        html += '</ol></div>';
    }
    document.getElementById('video-list').innerHTML = html;
}
function showCutInputs() {
    document.getElementById('input-start').classList.add('hidden');
    document.getElementById('input-middle').classList.add('hidden');
    document.getElementById('input-end').classList.add('hidden');
    let mode = document.querySelector('input[name="cut_mode"]:checked').value;
    if (mode == 'start') document.getElementById('input-start').classList.remove('hidden');
    if (mode == 'middle') document.getElementById('input-middle').classList.remove('hidden');
    if (mode == 'end') document.getElementById('input-end').classList.remove('hidden');
}
window.onload = showCutInputs;
</script>
{% endblock %}
